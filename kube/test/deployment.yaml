apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-pod
  namespace: m
  labels:
    app: hw
spec:
  replicas: 1
  selector:
    matchLabels:
      app: hw
  template:
    metadata:
      labels:
        app: hw
    spec:
      initContainers:
        - name: init-db
          image: postgres:14.5
#          ports:
#            - name: db
#              containerPort: 5432
#          env:
#            - name: POSTGRES_HOST
#              value: "localhost"
#            - name: POSTGRES_USER
#              value: postgres
#            - name: POSTGRES_PORT
#              value: "5432"
#            - name: POSTGRES_PASSWORD
#              value: password
#          command: [ 'sh', '-c',
#            'until pg_isready -h init-db -p 5432;
#                    do echo waiting for database; sleep 2; done;' ]
      containers:
        - image: ssv682/otus-homework-repo:v0.1
          name: otushw-stan
          ports:
            - name: web
              containerPort: 8080
    #      volumeMounts:
    #        - name: config
    #          mountPath: /config
          envFrom:
            - secretRef:
                name: mysecret
            - configMapRef:
                name: config-app
      volumes:
      - name: config-volume
        configMap:
          name: config-app
      - name: secrets
        secret:
          secretName: secret-stringdata
          defaultMode: 0400

